<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

       <!-- Bootstrap and jQuery -->
       <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

       <!--stylesheet and webfonts-->
       <link rel="stylesheet" type="text/css" href="style.css">
       <link href="https://fonts.googleapis.com/css?family=Playfair+Display&display=swap" rel="stylesheet">
       <link href="https://fonts.googleapis.com/css?family=PT+Serif&display=swap" rel="stylesheet">
       <link href="https://fonts.googleapis.com/css?family=DM+Serif+Text&display=swap" rel="stylesheet">

    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>plantBar</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
    <script type="text/babel">
    const handleResponse = (xhr, parseResponse) => {
        const content = document.querySelector('#content');
        const alertArea = document.querySelector('#alertArea');
  
        switch(xhr.status) {
          case 200:
            console.log('User retrieved successfully');
            break;
          case 201:
            if(alertArea.hasChildNodes()){
                alertArea.removeChild(alertArea.childNodes[0]);
                alertArea.appendChild(createAlert('User Created', 'success'));
            } else {
                alertArea.appendChild(createAlert('User Created', 'success'));
            }
            break;
          case 204:
            if(alertArea.hasChildNodes()){
                alertArea.removeChild(alertArea.childNodes[0]);
                alertArea.appendChild(createAlert('User Updated', 'success'));
            } else {
                alertArea.appendChild(createAlert('User Updated', 'success'));
            }
            break;
          case 400: 
            if(alertArea.hasChildNodes()){
                alertArea.removeChild(alertArea.childNodes[0]);
                alertArea.appendChild(createAlert('Please enter the required information', 'danger'));
            } else {
                alertArea.appendChild(createAlert('Please enter the required information', 'danger'));
            }
            break;
          case 404:
            if(alertArea.hasChildNodes()){
                alertArea.removeChild(alertArea.childNodes[0]);
                alertArea.appendChild(createAlert('404 Error - Not Found', 'danger'));
            } else {
                alertArea.appendChild(createAlert('404 Error - Not Found', 'danger'));
            }
            break;
          default: 
            if(alertArea.hasChildNodes()){
                alertArea.removeChild(alertArea.childNodes[0]);
                alertArea.appendChild(createAlert('Error - Not Implemented', 'danger'));
            } else {
                alertArea.appendChild(createAlert('Error - Not Implemented', 'danger'));
            }
            break;
        }
        
        if(parseResponse) {
          const obj = JSON.parse(xhr.response);
          console.dir(obj.status);

          if(obj.message !== undefined) {
            console.dir(obj.message);
          }
          
          if(obj.user) {
            console.dir(obj);

            if(content.hasChildNodes()){
                content.innerHTML = '';
            }

            const person = document.createElement('div');
            const name = document.createElement('h3');
            const plants = document.createElement('ul');
            const plant = document.createElement('li');
            const newPlant = document.createElement('button');

            document.querySelector('#addPlant').style.visibility = "visible"

            name.id = 'usersName';
            name.innerHTML = obj.user.userName;

            plants.id = 'plantList';
            plant.innerHTML = `${obj.user.plantName} : ${obj.user.plantType}`;

            plants.appendChild(plant);
            person.appendChild(name);
            person.appendChild(plants);

            content.appendChild(person);
          } 
        }
      };
    
      const requestUpdate = (e, userForm) => {
        const url = userForm.action;
        const method = userForm.method;
        const search = document.querySelector('#searchBar').value;
        
        const xhr = new XMLHttpRequest();
        xhr.open(method, url + search);
        xhr.setRequestHeader('Accept', 'application/json');
        if(method === 'get') {
          xhr.onload = () => handleResponse(xhr, true);
        } else {
          xhr.onload = () => handleResponse(xhr, false);
        }
        
        xhr.send();
        e.preventDefault();
        return false;
      };
  
      const sendPost = (e, userForm) => {
        const nameField = userForm.querySelector('#userName');
        const plantField = userForm.querySelector('#plantName');
        const plantTypeField = userForm.querySelector('#plantType');
        
        const xhr = new XMLHttpRequest();
        xhr.open('POST', '/addUser');
        
    
        xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
        xhr.setRequestHeader ('Accept', 'application/json');
        xhr.onload = () => handleResponse(xhr, false);
        
        const formData = `userName=${nameField.value}&plantName=${plantField.value}&plantType=${plantTypeField.value}`;
        
        xhr.send(formData);
        e.preventDefault();
        return false;
      };
      
      const init = () => {

        const userForm = document.querySelector('#newUser');
        const findUser = document.querySelector('#searchArea');

        const getUser = (e) => requestUpdate(e, findUser);
        const addUser = (e) => sendPost(e, userForm);
  
        findUser.addEventListener('submit', getUser);
        newUser.addEventListener('submit', addUser);
  
      };

      const createAlert = (message, type) => {
        let alert = document.createElement('div');
        alert.className = `alert alert-${type} float-left`;
        alert.role = 'alert';
        alert.innerHTML = message
        return alert;
      }
  
      window.onload = init;
  
    </script>
</head>
<body>
    <div class="container-fluid">
        <div class="row" id="mainArea">  
          <div class="col-sm" id="pic">
            <header class="row">
                <h1>plantBar.</h1>
            </header>
            
            <p>plant pic</p>
            <p id="waterInfo">Plant will need water in <strong>6</strong> days</p>
          </div>

          <div class="col-sm" id="infoArea">
            <h2>yourPlants</h2>
            <p>Enter your infomation or search an already made account</p>

            <form id="searchArea" class="input-group" action="/getUser?findUser=" method="get">
                <input type="text" class="form-control" placeholder="Enter name" id="searchBar">

                <div class="input-group-append">
                    <button type="submit" class="btn btn-outline-secondary" id="search">search</button>
                </div>
              </form>

            <div id="content">
                <form id="newUser" action="/addUser" method="post">
                    <div class="form-group">
                        <label for="newUser">Name</label>
                        <input type="text" class="form-control" id="userName" placeholder="your name">
                    </div>

                    <div class="form-group">
                        <label for="newUser">Plant Name</label>
                        <input type="text" class="form-control" id="plantName" placeholder="plant name">
                    </div>

                    <div class="form-group">
                        <label for="newUser">Plant Type</label> 
                        <button type="button" class="btn btn-outline-info float-right" data-toggle="modal" id="help" data-target="#plantTypes">
                               ?
                        </button>  
                        

                        <select class="form-control" id="plantType">
                            <option>Low Light</option>
                            <option>Indirect Light</option>
                            <option>Low Sunlight</option>
                            <option>Succulent</option>
                        </select>
                    </div>
                    <div id="alertArea"></div>
                    <button type="submit" class="btn btn-outline-secondary float-right" id="addUser">Add User</button>
                </form>
            </div>

            <!-- outside of content -->

            <button type="button" class="btn btn-outline-secondary float-right" data-toggle="modal" id="addPlant" data-target="#newPlant">Add Plant</button>
            
            <div class="modal fade" id="newPlant" tabindex="-1" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">New Plant</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">

                        <div class="form-group">
                            <label for="newUser">Plant Name</label>
                            <input type="text" class="form-control" id="newPlantName" placeholder="plant name">
                        </div>

                        <label for="newUser">Plant Type</label> 
                        <button type="button" class="btn btn-outline-info float-right" data-toggle="modal" id="help" data-target="#plantTypes">
                                ?
                        </button>  
                        <select class="form-control" id="newPlantType">
                            <option>Low Light</option>
                            <option>Indirect Light</option>
                            <option>Low Sunlight</option>
                            <option>Succulent</option>
                        </select>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" id="addNewPlant" class="btn btn-secondary" data-dismiss="modal">Add</button>
                    </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="plantTypes" tabindex="-1" role="dialog">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Plant Types</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <h3>Low Light</h3>
                                <p class="pInfo">Plants that need light just bright enough to read
                                    a newspaper during daylight hours.
                                </p>
                                <ul>
                                    <li>Pothos</li>
                                    <li>Bamboo</li>
                                    <li>Philodendron</li>
                                    <li>Peace Lily</li>
                                    <li>Snake Plant</li>
                                </ul>

                                <h3>Indirect Light</h3>
                                <p class="pInfo">Plants are plants that are within a few feet of a window, 
                                    but just out of the direct sunlight.</p>
                                <ul>
                                    <li>Money Plant</li>
                                    <li>Ferns</li>
                                    <li>Ivy</li>
                                    <li>Palms</li>
                                    <li>Monstera</li>
                                </ul>

                                <h3>Low Sunlight</h3>
                                <p class="pInfo">Plants that need direct sunlight, but only for 2-4 hours a day.</p>
                                <ul>
                                    <li>Aloe Vera</li>
                                    <li>Christmas Cactus</li>
                                    <li>Echeverias</li>
                                    <li>Spider Plant</li>
                                    <li>Pigmyweeds</li>
                                </ul>

                                <h3>Succulent</h3>
                                <p class="pInfo">Plants that require a half or full day of direct sunlight.</p>
                                <ul>
                                    <li>Hibiscus</li>
                                    <li>Geranium</li>
                                    <li>Citrus</li>
                                    <li>Succulents</li>
                                    <li>Herbs</li>
                                </ul>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>

          </div>
        </div>

        <footer class="row justify-content-center" >
            <p id="foot">Julia Hotaling © 2019</p>
        </footer>

      </div>

      <!--Required to run Bootstrap -->
      <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>
</html>